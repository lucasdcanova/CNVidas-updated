
> rest-express@1.0.0 dev
> tsx watch server/index.ts

AuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:11:54.854904+00
Session table checked/created successfully
9:11:54 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
[API] userCity raw: Tr√É¬™s Passos
[API] userCity encoded: Tr%C3%83%C2%AAs%20Passos
[API] userCity decoded: Tr√É¬™s Passos
Session table checked/created successfully
[Storage] Filtrando 12 servi√ßos para cidade: Tr√É¬™s Passos (raio: 50km)
[Storage] Servi√ßos filtrados: 0
[API] Total de servi√ßos filtrados: 0
[API] Servi√ßos filtrados para cidade: Tr√É¬™s Passos
[API] userCity raw: Tr√™s Passos
[API] userCity encoded: Tr%C3%AAs%20Passos
[API] userCity decoded: Tr√™s Passos
[Storage] Filtrando 12 servi√ßos para cidade: Tr√™s Passos (raio: 50km)
[Storage] Servi√ßos filtrados: 8
[API] Total de servi√ßos filtrados: 8
[API] Servi√ßos filtrados para cidade: Tr√™s Passos
[API] Exemplo de servi√ßo: {
  id: 6,
  name: 'Atendimento psicol√≥gico',
  isNational: false,
  distance: 0,
  serviceImage: 'Tem imagem',
  partner: 'Tem parceiro'
}
[API] userCity raw: Tr√™s Passos
[API] userCity encoded: Tr%C3%AAs%20Passos
[API] userCity decoded: Tr√™s Passos
[Storage] Filtrando 12 servi√ßos para cidade: Tr√™s Passos (raio: 50km)
[Storage] Servi√ßos filtrados: 8
[API] Total de servi√ßos filtrados: 8
[API] Servi√ßos filtrados para cidade: Tr√™s Passos
[API] Exemplo de servi√ßo: {
  id: 6,
  name: 'Atendimento psicol√≥gico',
  isNational: false,
  distance: 0,
  serviceImage: 'Tem imagem',
  partner: 'Tem parceiro'
}
9:12:55 PM [tsx] change in ./server/routes/index.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:12:57.095953+00
Session table checked/created successfully
9:12:57 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
9:13:06 PM [tsx] change in ./server/storage.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:13:07.232979+00
Session table checked/created successfully
9:13:07 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
9:13:11 PM [tsx] change in ./server/storage.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:13:12.540561+00
Session table checked/created successfully
9:13:12 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
9:13:12 PM [tsx] change in ./server/storage.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:13:13.85682+00
Session table checked/created successfully
9:13:13 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
9:31:59 PM [tsx] change in ./server/routes/auth-routes.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:32:01.003667+00
Session table checked/created successfully
9:32:01 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
9:32:07 PM [tsx] change in ./server/routes/auth-routes.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:32:09.249922+00
Session table checked/created successfully
9:32:09 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
9:36:51 PM [tsx] change in ./server/routes/appointment-join.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:36:52.743783+00
Session table checked/created successfully
9:36:53 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
9:37:00 PM [tsx] change in ./server/routes/appointment-join.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
node:internal/modules/run_main:129
    triggerUncaughtException(
    ^

Error: Transform failed with 1 error:
/Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/server/routes/appointment-join.ts:53:4: ERROR: Expected "finally" but found "if"
    at failureErrorWithLog (/Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/node_modules/tsx/node_modules/esbuild/lib/main.js:1463:15)
    at /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/node_modules/tsx/node_modules/esbuild/lib/main.js:734:50
    at responseCallbacks.<computed> (/Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/node_modules/tsx/node_modules/esbuild/lib/main.js:601:9)
    at handleIncomingPacket (/Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/node_modules/tsx/node_modules/esbuild/lib/main.js:656:12)
    at Socket.readFromStdout (/Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/node_modules/tsx/node_modules/esbuild/lib/main.js:579:7)
    at Socket.emit (node:events:519:28)
    at addChunk (node:internal/streams/readable:559:12)
    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)
    at Readable.push (node:internal/streams/readable:390:5)
    at Pipe.onStreamRead (node:internal/stream_base_commons:191:23) {
  name: 'TransformError'
}

Node.js v20.18.0
9:37:15 PM [tsx] change in ./server/routes/appointment-join.ts Rerunning...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:37:16.509628+00
Session table checked/created successfully
9:37:16 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
9:41:16 PM [tsx] change in ./server/routes/index.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:41:17.852575+00
Session table checked/created successfully
9:41:17 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
9:41:29 PM [tsx] change in ./server/routes/index.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:41:30.626089+00
Session table checked/created successfully
9:41:30 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
9:41:48 PM [tsx] change in ./server/chat-routes.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:41:50.059304+00
Session table checked/created successfully
9:41:50 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
9:42:24 PM [tsx] change in ./server/chat-routes.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:42:25.319488+00
Session table checked/created successfully
9:42:25 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
9:46:53 PM [tsx] change in ./server/routes/legal-documents-routes.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:46:55.36041+00
Session table checked/created successfully
9:46:55 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
9:56:03 PM [tsx] change in ./server/storage.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
9:56:04 PM [tsx] change in ./server/storage.ts Restarting...
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:56:05.791516+00
Session table checked/created successfully
9:56:05 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
9:56:20 PM [tsx] change in ./server/storage.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:56:22.174406+00
Session table checked/created successfully
9:56:22 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
9:56:24 PM [tsx] change in ./server/storage.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:56:25.008033+00
Session table checked/created successfully
9:56:25 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
9:56:26 PM [tsx] change in ./server/routes/appointment-join.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:56:27.799163+00
Session table checked/created successfully
9:56:27 PM [tsx] change in ./server/routes/appointment-join.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 00:56:28.736279+00
Session table checked/created successfully
9:56:28 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
10:11:45 PM [tsx] change in ./server/routes/public-subscription-routes.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
10:11:47 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 01:11:47.585725+00
Session table checked/created successfully
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
10:11:56 PM [tsx] change in ./server/routes/public-subscription-routes.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 01:11:57.468145+00
Session table checked/created successfully
10:11:57 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /unread-count
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
üîç Notifications /unread-count - Buscando contagem para usu√°rio ID: 58
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
‚ö†Ô∏è Arquivo de upload n√£o encontrado: /profiles/profile-1749862980983-114661775.jpg
üîÑ Redirecionando para imagem padr√£o: /profiles/profile-1749862980983-114661775.jpg
‚úÖ Notifications /unread-count - Contagem: 2
‚úÖ Assinatura encontrada: {
  subscription: {
    id: 1,
    userId: 58,
    planId: 10,
    status: 'active',
    startDate: 2025-06-08T23:10:30.449Z,
    endDate: 2026-06-08T23:10:30.449Z,
    paymentMethod: 'admin_grant',
    price: 23990,
    createdAt: 2025-06-08T23:10:30.449Z,
    updatedAt: 2025-06-08T23:10:30.449Z
  },
  plan: {
    id: 10,
    name: 'ultra_family',
    displayName: 'Ultra Familiar',
    price: 23990,
    emergencyConsultations: 'unlimited',
    specialistDiscount: 70,
    insuranceCoverage: true,
    features: [
      'Mesmos benef√≠cios do Ultra para cada dependente',
      'At√© 4 CPFs',
      'Teleconsultas de emerg√™ncia ilimitadas',
      '70% de desconto com especialistas',
      'Prioridade m√°xima de agendamento',
      'Cobertura de seguro: R$ 500/dia de interna√ß√£o',
      'Todos os demais benef√≠cios dos planos anteriores'
    ],
    isDefault: false,
    createdAt: 2025-05-20T02:56:59.709Z,
    updatedAt: 2025-05-20T02:56:59.709Z
  }
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /upcoming
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
Buscando consultas pr√≥ximas para usu√°rio 58
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
Buscando claims para usu√°rio 58
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /recent-activities
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
üîç Activities - Buscando atividades recentes do usu√°rio ID: 58
Encontradas 1 consultas pr√≥ximas
Encontrados 0 claims
Session table checked/created successfully
‚úÖ Activities - Atividades encontradas: 6
[API] Total de servi√ßos filtrados: 12
[API] Exemplo de servi√ßo: {
  id: 24,
  name: 'Vacinas',
  isNational: false,
  distance: undefined,
  serviceImage: 'Tem imagem',
  partner: 'Tem parceiro'
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /profile
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para PUT /profile
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
üîÑ Atualizando perfil do usu√°rio 58 com campos: [
  'phone',
  'birthDate',
  'city',
  'state',
  'zipcode',
  'number',
  'complement',
  'neighborhood'
]
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /profile
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /profile
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== UPLOAD PROFILE IMAGE (PATIENT) ===
User ID: 58
File received: {
  filename: 'profile-1749869106047-332006128.jpg',
  originalname: 'profile.jpg',
  mimetype: 'image/jpeg',
  size: '0.13MB'
}
Image URL gerada: /uploads/profiles/profile-1749869106047-332006128.jpg
Update result: Result {
  command: 'UPDATE',
  rowCount: 1,
  oid: null,
  rows: [],
  fields: [],
  _parsers: undefined,
  _types: TypeOverrides {
    _types: {
      getTypeParser: [Function: getTypeParser],
      setTypeParser: [Function: setTypeParser],
      arrayParser: [Object],
      builtins: [Object]
    },
    text: {},
    binary: {}
  },
  RowCtor: null,
  rowAsArray: false
}
Imagem antiga removida: /uploads/profiles/profile-1749862980983-114661775.jpg
Upload de paciente conclu√≠do com sucesso
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /profile
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /profile
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
‚ö†Ô∏è Arquivo de upload n√£o encontrado: /profiles/profile-1749869106047-332006128.jpg
üîÑ Redirecionando para imagem padr√£o: /profiles/profile-1749869106047-332006128.jpg
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
‚ö†Ô∏è Arquivo de upload n√£o encontrado: /profile-1747876767178-948110885.jpg
üîÑ Redirecionando para imagem padr√£o: /profile-1747876767178-948110885.jpg
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
‚ö†Ô∏è Arquivo de upload n√£o encontrado: /profile-1747951137232-694756185.jpg
üîÑ Redirecionando para imagem padr√£o: /profile-1747951137232-694756185.jpg
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
[API] Total de servi√ßos filtrados: 8
[API] Servi√ßos filtrados para cidade: Tr√™s Passos
[API] Exemplo de servi√ßo: {
  id: 6,
  name: 'Atendimento psicol√≥gico',
  isNational: false,
  distance: 0,
  serviceImage: 'Tem imagem',
  partner: 'Tem parceiro'
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
GET /api/dependents - Request received: {
  user: {
    id: 58,
    email: 'lucas.canova@hotmail.com',
    role: 'patient',
    fullName: 'Lucas Dickel Canova',
    username: 'p03474256076',
    emailVerified: true,
    subscriptionPlan: 'ultra_family',
    subscriptionStatus: 'active',
    emergencyConsultationsLeft: 8,
    emergencyConsultationsResetAt: undefined,
    profileImage: '/uploads/profiles/profile-1749869106047-332006128.jpg',
    phone: '',
    cpf: null,
    cnpj: undefined,
    city: 'Tr√™s Passos',
    state: 'RS',
    address: '',
    zipcode: '98600000'
  },
  url: '/',
  headers: {
    host: 'localhost:8080',
    connection: 'close',
    'cache-control': 'no-cache, no-store, must-revalidate',
    expires: '0',
    'sec-ch-ua-platform': '"macOS"',
    'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36',
    pragma: 'no-cache',
    'sec-ch-ua': '"Google Chrome";v="137", "Chromium";v="137", "Not/A)Brand";v="24"',
    'sec-ch-ua-mobile': '?0',
    accept: '*/*',
    'sec-fetch-site': 'same-origin',
    'sec-fetch-mode': 'cors',
    'sec-fetch-dest': 'empty',
    referer: 'http://localhost:5173/dependents',
    'accept-encoding': 'gzip, deflate, br, zstd',
    'accept-language': 'pt-BR,pt;q=0.9,en-US;q=0.8,en;q=0.7',
    cookie: '__stripe_mid=1861aef6-543f-4483-ab4b-09818dff49e4c5183e; auth_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34; __stripe_sid=7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
  }
}
Buscando dependentes para usu√°rio ID: 58
Dependentes encontrados: 1
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
Retornando planos de assinatura para usu√°rio (rota p√∫blica): [
  {
    id: 4,
    name: 'free',
    displayName: 'Gratuito',
    price: 0,
    emergencyConsultations: '0',
    specialistDiscount: 0,
    insuranceCoverage: false,
    features: [
      'Acesso ao marketplace',
      'Pagamento integral pelos servi√ßos',
      '0 teleconsultas de emerg√™ncia por m√™s',
      'Sem descontos e sem cobertura de seguro'
    ],
    isDefault: true,
    createdAt: 2025-05-19T14:54:18.234Z,
    updatedAt: 2025-05-19T14:54:18.234Z
  },
  {
    id: 5,
    name: 'basic',
    displayName: 'B√°sico',
    price: 8990,
    emergencyConsultations: '2',
    specialistDiscount: 30,
    insuranceCoverage: true,
    features: [
      '2 teleconsultas de emerg√™ncia por m√™s',
      '30% de desconto com especialistas',
      'Acesso completo aos descontos de parceiros',
      'Cobertura de seguro: R$ 300/dia de interna√ß√£o',
      'Suporte 24/7'
    ],
    isDefault: false,
    createdAt: 2025-05-19T14:54:18.234Z,
    updatedAt: 2025-05-19T14:54:18.234Z
  },
  {
    id: 6,
    name: 'premium',
    displayName: 'Premium',
    price: 12990,
    emergencyConsultations: 'unlimited',
    specialistDiscount: 50,
    insuranceCoverage: true,
    features: [
      'Teleconsultas de emerg√™ncia ilimitadas',
      '50% de desconto com especialistas',
      'Prioridade de agendamento',
      'Cobertura de seguro: R$ 300/dia de interna√ß√£o',
      'Suporte priorit√°rio 24/7'
    ],
    isDefault: false,
    createdAt: 2025-05-19T14:54:18.234Z,
    updatedAt: 2025-05-19T14:54:18.234Z
  },
  {
    id: 7,
    name: 'basic_family',
    displayName: 'B√°sico Familiar',
    price: 14990,
    emergencyConsultations: '2',
    specialistDiscount: 30,
    insuranceCoverage: true,
    features: [
      'Mesmos benef√≠cios do B√°sico para cada dependente',
      'At√© 4 CPFs',
      '2 teleconsultas de emerg√™ncia por m√™s',
      '30% de desconto com especialistas',
      'Acesso completo aos descontos de parceiros',
      'Cobertura de seguro: R$ 300/dia de interna√ß√£o',
      'Suporte 24/7'
    ],
    isDefault: false,
    createdAt: 2025-05-20T02:56:59.709Z,
    updatedAt: 2025-05-20T02:56:59.709Z
  },
  {
    id: 8,
    name: 'premium_family',
    displayName: 'Premium Familiar',
    price: 19990,
    emergencyConsultations: 'unlimited',
    specialistDiscount: 50,
    insuranceCoverage: true,
    features: [
      'Mesmos benef√≠cios do Premium para cada dependente',
      'At√© 4 CPFs',
      'Teleconsultas de emerg√™ncia ilimitadas',
      '50% de desconto com especialistas',
      'Prioridade de agendamento',
      'Cobertura de seguro: R$ 300/dia de interna√ß√£o',
      'Suporte priorit√°rio 24/7'
    ],
    isDefault: false,
    createdAt: 2025-05-20T02:56:59.709Z,
    updatedAt: 2025-05-20T02:56:59.709Z
  },
  {
    id: 9,
    name: 'ultra',
    displayName: 'Ultra',
    price: 16990,
    emergencyConsultations: 'unlimited',
    specialistDiscount: 70,
    insuranceCoverage: true,
    features: [
      'Teleconsultas de emerg√™ncia ilimitadas',
      '70% de desconto com especialistas',
      'Prioridade m√°xima de agendamento',
      'Cobertura de seguro: R$ 500/dia de interna√ß√£o',
      'Todos os demais benef√≠cios dos planos anteriores'
    ],
    isDefault: false,
    createdAt: 2025-05-20T02:56:59.709Z,
    updatedAt: 2025-05-20T02:56:59.709Z
  },
  {
    id: 10,
    name: 'ultra_family',
    displayName: 'Ultra Familiar',
    price: 23990,
    emergencyConsultations: 'unlimited',
    specialistDiscount: 70,
    insuranceCoverage: true,
    features: [
      'Mesmos benef√≠cios do Ultra para cada dependente',
      'At√© 4 CPFs',
      'Teleconsultas de emerg√™ncia ilimitadas',
      '70% de desconto com especialistas',
      'Prioridade m√°xima de agendamento',
      'Cobertura de seguro: R$ 500/dia de interna√ß√£o',
      'Todos os demais benef√≠cios dos planos anteriores'
    ],
    isDefault: false,
    createdAt: 2025-05-20T02:56:59.709Z,
    updatedAt: 2025-05-20T02:56:59.709Z
  }
]
‚úÖ Assinatura encontrada: {
  subscription: {
    id: 1,
    userId: 58,
    planId: 10,
    status: 'active',
    startDate: 2025-06-08T23:10:30.449Z,
    endDate: 2026-06-08T23:10:30.449Z,
    paymentMethod: 'admin_grant',
    price: 23990,
    createdAt: 2025-06-08T23:10:30.449Z,
    updatedAt: 2025-06-08T23:10:30.449Z
  },
  plan: {
    id: 10,
    name: 'ultra_family',
    displayName: 'Ultra Familiar',
    price: 23990,
    emergencyConsultations: 'unlimited',
    specialistDiscount: 70,
    insuranceCoverage: true,
    features: [
      'Mesmos benef√≠cios do Ultra para cada dependente',
      'At√© 4 CPFs',
      'Teleconsultas de emerg√™ncia ilimitadas',
      '70% de desconto com especialistas',
      'Prioridade m√°xima de agendamento',
      'Cobertura de seguro: R$ 500/dia de interna√ß√£o',
      'Todos os demais benef√≠cios dos planos anteriores'
    ],
    isDefault: false,
    createdAt: 2025-05-20T02:56:59.709Z,
    updatedAt: 2025-05-20T02:56:59.709Z
  }
}
‚úÖ Assinatura encontrada: {
  subscription: {
    id: 1,
    userId: 58,
    planId: 10,
    status: 'active',
    startDate: 2025-06-08T23:10:30.449Z,
    endDate: 2026-06-08T23:10:30.449Z,
    paymentMethod: 'admin_grant',
    price: 23990,
    createdAt: 2025-06-08T23:10:30.449Z,
    updatedAt: 2025-06-08T23:10:30.449Z
  },
  plan: {
    id: 10,
    name: 'ultra_family',
    displayName: 'Ultra Familiar',
    price: 23990,
    emergencyConsultations: 'unlimited',
    specialistDiscount: 70,
    insuranceCoverage: true,
    features: [
      'Mesmos benef√≠cios do Ultra para cada dependente',
      'At√© 4 CPFs',
      'Teleconsultas de emerg√™ncia ilimitadas',
      '70% de desconto com especialistas',
      'Prioridade m√°xima de agendamento',
      'Cobertura de seguro: R$ 500/dia de interna√ß√£o',
      'Todos os demais benef√≠cios dos planos anteriores'
    ],
    isDefault: false,
    createdAt: 2025-05-20T02:56:59.709Z,
    updatedAt: 2025-05-20T02:56:59.709Z
  }
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ATIVANDO PLANO GRATUITO ===
Headers recebidos: {
  host: 'localhost:8080',
  connection: 'close',
  'content-length': '2',
  'cache-control': 'no-cache, no-store, must-revalidate',
  'sec-ch-ua-platform': '"macOS"',
  pragma: 'no-cache',
  'sec-ch-ua': '"Google Chrome";v="137", "Chromium";v="137", "Not/A)Brand";v="24"',
  'sec-ch-ua-mobile': '?0',
  expires: '0',
  'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36',
  'content-type': 'application/json',
  accept: '*/*',
  origin: 'http://localhost:5173',
  'sec-fetch-site': 'same-origin',
  'sec-fetch-mode': 'cors',
  'sec-fetch-dest': 'empty',
  referer: 'http://localhost:5173/first-subscription',
  'accept-encoding': 'gzip, deflate, br, zstd',
  'accept-language': 'pt-BR,pt;q=0.9,en-US;q=0.8,en;q=0.7',
  cookie: '__stripe_mid=1861aef6-543f-4483-ab4b-09818dff49e4c5183e; auth_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34; __stripe_sid=7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
Cookies dispon√≠veis: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
Usu√°rio autenticado via cookie auth_token: 58 lucas.canova@hotmail.com
‚úÖ Ativando plano gratuito para usu√°rio lucas.canova@hotmail.com
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /unread-count
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
üîç Notifications /unread-count - Buscando contagem para usu√°rio ID: 58
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Notifications /unread-count - Contagem: 2
‚úÖ Assinatura encontrada: {
  subscription: {
    id: 1,
    userId: 58,
    planId: 10,
    status: 'active',
    startDate: 2025-06-08T23:10:30.449Z,
    endDate: 2026-06-08T23:10:30.449Z,
    paymentMethod: 'admin_grant',
    price: 23990,
    createdAt: 2025-06-08T23:10:30.449Z,
    updatedAt: 2025-06-08T23:10:30.449Z
  },
  plan: {
    id: 10,
    name: 'ultra_family',
    displayName: 'Ultra Familiar',
    price: 23990,
    emergencyConsultations: 'unlimited',
    specialistDiscount: 70,
    insuranceCoverage: true,
    features: [
      'Mesmos benef√≠cios do Ultra para cada dependente',
      'At√© 4 CPFs',
      'Teleconsultas de emerg√™ncia ilimitadas',
      '70% de desconto com especialistas',
      'Prioridade m√°xima de agendamento',
      'Cobertura de seguro: R$ 500/dia de interna√ß√£o',
      'Todos os demais benef√≠cios dos planos anteriores'
    ],
    isDefault: false,
    createdAt: 2025-05-20T02:56:59.709Z,
    updatedAt: 2025-05-20T02:56:59.709Z
  }
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /upcoming
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
Buscando consultas pr√≥ximas para usu√°rio 58
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
Buscando claims para usu√°rio 58
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /recent-activities
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
üîç Activities - Buscando atividades recentes do usu√°rio ID: 58
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
Encontradas 1 consultas pr√≥ximas
Encontrados 0 claims
‚úÖ Activities - Atividades encontradas: 6
[API] Total de servi√ßos filtrados: 12
[API] Exemplo de servi√ßo: {
  id: 24,
  name: 'Vacinas',
  isNational: false,
  distance: undefined,
  serviceImage: 'Tem imagem',
  partner: 'Tem parceiro'
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /recent-activities
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
üîç Activities - Buscando atividades recentes do usu√°rio ID: 58
‚úÖ Assinatura encontrada: {
  subscription: {
    id: 1,
    userId: 58,
    planId: 10,
    status: 'active',
    startDate: 2025-06-08T23:10:30.449Z,
    endDate: 2026-06-08T23:10:30.449Z,
    paymentMethod: 'admin_grant',
    price: 23990,
    createdAt: 2025-06-08T23:10:30.449Z,
    updatedAt: 2025-06-08T23:10:30.449Z
  },
  plan: {
    id: 10,
    name: 'ultra_family',
    displayName: 'Ultra Familiar',
    price: 23990,
    emergencyConsultations: 'unlimited',
    specialistDiscount: 70,
    insuranceCoverage: true,
    features: [
      'Mesmos benef√≠cios do Ultra para cada dependente',
      'At√© 4 CPFs',
      'Teleconsultas de emerg√™ncia ilimitadas',
      '70% de desconto com especialistas',
      'Prioridade m√°xima de agendamento',
      'Cobertura de seguro: R$ 500/dia de interna√ß√£o',
      'Todos os demais benef√≠cios dos planos anteriores'
    ],
    isDefault: false,
    createdAt: 2025-05-20T02:56:59.709Z,
    updatedAt: 2025-05-20T02:56:59.709Z
  }
}
‚úÖ Activities - Atividades encontradas: 6
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada: {
  subscription: {
    id: 1,
    userId: 58,
    planId: 10,
    status: 'active',
    startDate: 2025-06-08T23:10:30.449Z,
    endDate: 2026-06-08T23:10:30.449Z,
    paymentMethod: 'admin_grant',
    price: 23990,
    createdAt: 2025-06-08T23:10:30.449Z,
    updatedAt: 2025-06-08T23:10:30.449Z
  },
  plan: {
    id: 10,
    name: 'ultra_family',
    displayName: 'Ultra Familiar',
    price: 23990,
    emergencyConsultations: 'unlimited',
    specialistDiscount: 70,
    insuranceCoverage: true,
    features: [
      'Mesmos benef√≠cios do Ultra para cada dependente',
      'At√© 4 CPFs',
      'Teleconsultas de emerg√™ncia ilimitadas',
      '70% de desconto com especialistas',
      'Prioridade m√°xima de agendamento',
      'Cobertura de seguro: R$ 500/dia de interna√ß√£o',
      'Todos os demais benef√≠cios dos planos anteriores'
    ],
    isDefault: false,
    createdAt: 2025-05-20T02:56:59.709Z,
    updatedAt: 2025-05-20T02:56:59.709Z
  }
}
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada: {
  subscription: {
    id: 1,
    userId: 58,
    planId: 10,
    status: 'active',
    startDate: 2025-06-08T23:10:30.449Z,
    endDate: 2026-06-08T23:10:30.449Z,
    paymentMethod: 'admin_grant',
    price: 23990,
    createdAt: 2025-06-08T23:10:30.449Z,
    updatedAt: 2025-06-08T23:10:30.449Z
  },
  plan: {
    id: 10,
    name: 'ultra_family',
    displayName: 'Ultra Familiar',
    price: 23990,
    emergencyConsultations: 'unlimited',
    specialistDiscount: 70,
    insuranceCoverage: true,
    features: [
      'Mesmos benef√≠cios do Ultra para cada dependente',
      'At√© 4 CPFs',
      'Teleconsultas de emerg√™ncia ilimitadas',
      '70% de desconto com especialistas',
      'Prioridade m√°xima de agendamento',
      'Cobertura de seguro: R$ 500/dia de interna√ß√£o',
      'Todos os demais benef√≠cios dos planos anteriores'
    ],
    isDefault: false,
    createdAt: 2025-05-20T02:56:59.709Z,
    updatedAt: 2025-05-20T02:56:59.709Z
  }
}
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada: {
  subscription: {
    id: 1,
    userId: 58,
    planId: 10,
    status: 'active',
    startDate: 2025-06-08T23:10:30.449Z,
    endDate: 2026-06-08T23:10:30.449Z,
    paymentMethod: 'admin_grant',
    price: 23990,
    createdAt: 2025-06-08T23:10:30.449Z,
    updatedAt: 2025-06-08T23:10:30.449Z
  },
  plan: {
    id: 10,
    name: 'ultra_family',
    displayName: 'Ultra Familiar',
    price: 23990,
    emergencyConsultations: 'unlimited',
    specialistDiscount: 70,
    insuranceCoverage: true,
    features: [
      'Mesmos benef√≠cios do Ultra para cada dependente',
      'At√© 4 CPFs',
      'Teleconsultas de emerg√™ncia ilimitadas',
      '70% de desconto com especialistas',
      'Prioridade m√°xima de agendamento',
      'Cobertura de seguro: R$ 500/dia de interna√ß√£o',
      'Todos os demais benef√≠cios dos planos anteriores'
    ],
    isDefault: false,
    createdAt: 2025-05-20T02:56:59.709Z,
    updatedAt: 2025-05-20T02:56:59.709Z
  }
}
11:51:22 PM [tsx] change in ./server/routes/public-subscription-routes.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 02:51:24.805346+00
Session table checked/created successfully
11:51:25 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
11:51:31 PM [tsx] change in ./server/routes/public-subscription-routes.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 02:51:32.564279+00
Session table checked/created successfully
11:51:32 PM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
Buscando claims para usu√°rio 58
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /recent-activities
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
üîç Activities - Buscando atividades recentes do usu√°rio ID: 58
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
Encontrados 0 claims
Session table checked/created successfully
‚úÖ Activities - Atividades encontradas: 6
[API] Total de servi√ßos filtrados: 12
[API] Exemplo de servi√ßo: {
  id: 24,
  name: 'Vacinas',
  isNational: false,
  distance: undefined,
  serviceImage: 'Tem imagem',
  partner: 'Tem parceiro'
}
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
[API] Total de servi√ßos filtrados: 8
[API] Servi√ßos filtrados para cidade: Tr√™s Passos
[API] Exemplo de servi√ßo: {
  id: 6,
  name: 'Atendimento psicol√≥gico',
  isNational: false,
  distance: 0,
  serviceImage: 'Tem imagem',
  partner: 'Tem parceiro'
}
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /recent-activities
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
üîç Activities - Buscando atividades recentes do usu√°rio ID: 58
‚úÖ Activities - Atividades encontradas: 6
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
12:00:07 AM [tsx] change in ./server/routes/user-routes.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 03:00:08.751464+00
Session table checked/created successfully
12:00:08 AM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
12:00:18 AM [tsx] change in ./server/routes/user-routes.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 03:00:21.807237+00
Session table checked/created successfully
12:00:22 AM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /recent-activities
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
üîç Activities - Buscando atividades recentes do usu√°rio ID: 58
‚úÖ Activities - Atividades encontradas: 6
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /recent-activities
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
üîç Activities - Buscando atividades recentes do usu√°rio ID: 58
‚úÖ Activities - Atividades encontradas: 6
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîê requireAuth - Verificando autentica√ß√£o para GET /recent-activities
üîê requireAuth - req.user: 58 (patient)
‚úÖ requireAuth - Usu√°rio autenticado: 58 (patient)
üîç Activities - Buscando atividades recentes do usu√°rio ID: 58
‚úÖ Activities - Atividades encontradas: 6
12:02:33 AM [tsx] change in ./server/routes/user-routes.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
Conex√£o com o banco de dados testada com sucesso: 2025-06-14 03:02:35.188779+00
Session table checked/created successfully
12:02:35 AM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
12:02:42 AM [tsx] change in ./server/routes/user-routes.ts Restarting...
cAuthRouter carregado - rotas dispon√≠veis:
- POST /register
- POST /login
- POST /test
- GET /user (verifica√ß√£o de autentica√ß√£o)
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
üñºÔ∏è Configurando diret√≥rio de arquivos est√°ticos...
‚úÖ Arquivos est√°ticos servidos de: /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/public
Registrando authRouter em /api/auth
Registrando userRouter em /api/users
Registrando adminRoutes em /api/admin
Registrando partnerRouter em /api/partners
Registrando doctorRouter em /api/doctors
Registrando notificationRouter em /api/notifications
Registrando checkoutTrackingRouter em /api
Registrando rotas p√∫blicas de m√©dicos em /api/doctors
Registrando rotas p√∫blicas de servi√ßos em /api/services
Registrando legalDocumentsRouter em /api/legal-documents
Registrando chatRouter em /api/chat
Erro ao testar conex√£o com o banco de dados: Error: Connection terminated due to connection timeout
    at /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/node_modules/@neondatabase/serverless/index.js:1086:33
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at runNextTicks (node:internal/process/task_queues:64:3)
    at listOnTimeout (node:internal/timers:545:9)
    at process.processTimers (node:internal/timers:519:7)
    at async testConnection (/Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/server/db.ts:34:20) {
  [cause]: ErrorEvent {
    [Symbol(kTarget)]: WebSocket {
      _events: [Object: null prototype],
      _eventsCount: 4,
      _maxListeners: undefined,
      _binaryType: 'arraybuffer',
      _closeCode: 1006,
      _closeFrameReceived: false,
      _closeFrameSent: false,
      _closeMessage: <Buffer >,
      _closeTimer: null,
      _errorEmitted: true,
      _extensions: {},
      _paused: false,
      _protocol: '',
      _readyState: 3,
      _receiver: null,
      _sender: null,
      _socket: null,
      _bufferedAmount: 0,
      _isServer: false,
      _redirects: 0,
      _autoPong: true,
      _url: 'wss://ep-wandering-dawn-acwbhdh4-pooler.sa-east-1.aws.neon.tech/v2',
      _req: [ClientRequest],
      [Symbol(shapeMode)]: false,
      [Symbol(kCapture)]: false
    },
    [Symbol(kType)]: 'error',
    [Symbol(kError)]: Error: WebSocket was closed before the connection was established
        at WebSocket.close (/Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/node_modules/ws/lib/websocket.js:299:7)
        at /Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/node_modules/@neondatabase/serverless/index.js:425:4
        at S.write (/Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/node_modules/@neondatabase/serverless/index.js:422:51)
        at S.end (/Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/node_modules/@neondatabase/serverless/index.js:424:83)
        at S.destroy (/Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/node_modules/@neondatabase/serverless/index.js:425:63)
        at Timeout.<anonymous> (/Users/lucascanova/Documents/CNVidas 1.0/CNVidas-updated/node_modules/@neondatabase/serverless/index.js:1116:99)
        at listOnTimeout (node:internal/timers:581:17)
        at process.processTimers (node:internal/timers:519:7),
    [Symbol(kMessage)]: 'WebSocket was closed before the connection was established'
  }
}
Session table checked/created successfully
12:02:47 AM [server] Servidor rodando na porta 8080
Acesse: http://localhost:8080
Ou: http://127.0.0.1:8080
Configura√ß√£o de email carregada. Servi√ßo de email dispon√≠vel.
üîç Middleware JWT Global - Processando: /api/subscription/current
üîç Cookies: {
  __stripe_mid: '1861aef6-543f-4483-ab4b-09818dff49e4c5183e',
  auth_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjU4LCJlbWFpbCI6Imx1Y2FzLmNhbm92YUBob3RtYWlsLmNvbSIsInJvbGUiOiJwYXRpZW50IiwiaWF0IjoxNzQ5NDIzNzk3LCJleHAiOjE3NTAwMjg1OTd9.etqRBoYdkIPLS5kwKiqUgwNtgw9hLmU8KLwGC2lTe34',
  __stripe_sid: '7c40b497-1ceb-4182-820a-71f532e8cd44f0b120'
}
üîç Headers auth: undefined
üîç Header x-auth-token: undefined
üîç Verificando cookie auth_token: eyJhbGciOiJIUzI1NiIs...
üîç Cookie decodificado: {
  userId: 58,
  email: 'lucas.canova@hotmail.com',
  role: 'patient',
  iat: 1749423797,
  exp: 1750028597
}
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
=== ROTA /api/user INTERCEPTADA ===
üîê JWT: Usu√°rio lucas.canova@hotmail.com autenticado via cookie com plano ultra_family
üîç Final do middleware - Usu√°rio autenticado? true
Verificando autentica√ß√£o na rota de assinatura...
‚úÖ Usu√°rio autenticado: lucas.canova@hotmail.com
üîç Buscando assinatura atual para usu√°rio lucas.canova@hotmail.com (ID: 58)
‚úÖ Assinatura encontrada:
   - ID: 1
   - Status: active
   - Plano: ultra_family
   - Data cria√ß√£o: Sun Jun 08 2025 20:10:30 GMT-0300 (Brasilia Standard Time)
